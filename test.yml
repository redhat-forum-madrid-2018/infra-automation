---
- hosts: git
  remote_user: root
  tasks:
    - name: test
      debug:
        msg: "{{ hostvars[item]['ansible_host'] }}"
      with_items:
        - "{{ groups['all'] }}"

    - name: "Build hosts file"
      lineinfile:
        dest: /etc/hosts
        regexp: ".*{{ item }}$"
        line: "{{ hostvars[item]['ansible_host'] }} {{ item }}"
        state: present
      with_items:
        - "{{ groups['all'] }}"
